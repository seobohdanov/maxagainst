# Скрипты для управления базой данных

## Очистка базы данных

Скрипт `clean-database.js` позволяет безопасно очистить базу данных MongoDB для тестирования.

### Использование

```bash
# Показать статистику базы данных (по умолчанию)
node scripts/clean-database.js

# Или явно указать опцию 6
node scripts/clean-database.js 6
```

### Опции очистки

**1. Тільки тестові дані** (рекомендовано для тестирования)
```bash
node scripts/clean-database.js 1
```
- Удаляет: привітання, статуси генерації, callback'и
- Сохраняет: налаштування адміна, платежі

**2. Все крім налаштувань**
```bash
node scripts/clean-database.js 2
```
- Удаляет: привітання, статуси генерації, платежі, callback'и
- Сохраняет: налаштування адміна

**3. Повна очистка** ⚠️ ОСТОРОЖНО!
```bash
node scripts/clean-database.js 3
```
- Удаляет: ВСЕ данные включая налаштування адміна

**4. Тільки незавершені генерації**
```bash
node scripts/clean-database.js 4
```
- Удаляет только записи со статусом: PENDING, TEXT_SUCCESS, FIRST_SUCCESS, ERROR, FAILED

**5. Тільки старі дані** (старше 7 днів)
```bash
node scripts/clean-database.js 5
```
- Удаляет данные старше недели

**6. Показати статистику**
```bash
node scripts/clean-database.js 6
```
- Показывает детальную статистику без удаления

### Коллекции в базе данных

- `greetings` - основные привітання пользователей
- `generation_status` - статусы генерации музыки
- `payments` - информация о платежах
- `settings` - налаштування приложения (цены, режим обслуживания)
- `suno_callbacks` - callback'и от Suno API

### Безопасность

- Скрипт показывает статистику перед удалением
- Все операции логируются
- Можно выбрать что именно удалять
- Налаштування адміна можно сохранить

### Примеры использования

**Для начала тестирования с чистого листа:**
```bash
node scripts/clean-database.js 1
```

**Для полной переустановки (осторожно!):**
```bash
node scripts/clean-database.js 3
```

**Для очистки только неудачных генераций:**
```bash
node scripts/clean-database.js 4
```

### Восстановление

После очистки:
1. Налаштування адміна восстановятся автоматически (если сохранены)
2. Можно заново настроить цены в админ-панели `/admin`
3. Пользователи смогут создавать новые привітання
