# GDPR и обработка согласий пользователей

## Обязательные данные для сохранения по закону

### 1. Основные данные согласия
- **Email пользователя** - для идентификации
- **Дата и время согласия** - точная дата получения согласия
- **IP адрес** - для доказательства получения согласия
- **User Agent** - информация о браузере
- **Тип согласия** - с чем именно согласился пользователь

### 2. Типы согласий в нашем приложении

#### Обязательное согласие (Terms & Privacy)
- Согласие с условиями использования
- Согласие с политикой конфиденциальности
- **Обязательно для входа в систему**

#### Добровольное согласие (Marketing)
- Согласие на получение маркетинговых материалов
- Согласие на новости и предложения
- **Не обязательно для использования сервиса**

## Реализованная функциональность

### 1. Модальное окно авторизации
- Два чекбокса: обязательный и добровольный
- Кнопка Google активна только после согласия с условиями
- Сохранение согласий перед авторизацией

### 2. API endpoints
- `/api/consent/save` - сохранение согласий
- `/api/consent/update-email` - обновление email после авторизации
- `/api/admin/consents` - получение согласий для админки
- `/api/admin/consents/export` - экспорт в CSV

### 3. Админ панель
- Просмотр всех согласий
- Фильтрация по типу согласия
- Поиск по email
- Экспорт в CSV

## Структура данных в MongoDB

```javascript
{
  _id: ObjectId,
  email: String, // Может быть null до авторизации
  sessionId: String, // Для связи с сессией до авторизации
  termsConsent: {
    agreed: Boolean,
    date: Date,
    ipAddress: String,
    userAgent: String
  },
  marketingConsent: {
    agreed: Boolean,
    date: Date,
    ipAddress: String,
    userAgent: String
  } | null,
  createdAt: Date,
  updatedAt: Date
}
```

## Правовые требования

### 1. GDPR (Европейский регламент)
- **Прозрачность** - пользователь должен знать, на что соглашается
- **Свобода выбора** - согласие должно быть добровольным
- **Возможность отзыва** - пользователь может отозвать согласие
- **Право на забвение** - пользователь может потребовать удаления данных

### 2. Закон Украины "О защите персональных данных"
- Согласие должно быть конкретным и информированным
- Необходимо указать цель обработки данных
- Пользователь должен иметь возможность отозвать согласие

### 3. Рекомендации по реализации

#### В модальном окне:
- Четкие и понятные формулировки
- Ссылки на полные документы
- Разделение обязательных и добровольных согласий
- Возможность продолжить без маркетингового согласия

#### В админке:
- Полная история согласий
- Возможность экспорта для аудита
- Информация о дате и способе получения согласия

## Тестирование

### 1. Тест обязательного согласия
1. Откройте модальное окно авторизации
2. Попробуйте нажать "Увійти через Google" без чекбокса
3. Кнопка должна быть неактивна
4. Должно появиться сообщение об ошибке

### 2. Тест добровольного согласия
1. Поставьте только обязательный чекбокс
2. Нажмите "Увійти через Google"
3. Вход должен пройти успешно
4. В админке должно быть сохранено только обязательное согласие

### 3. Тест сохранения данных
1. Войдите в систему
2. Проверьте админку `/admin/consents`
3. Должна быть запись с email, IP и датами

## Безопасность

### 1. Защита данных
- Все данные сохраняются в MongoDB
- IP адреса и User Agent для аудита
- Шифрование соединения с базой данных

### 2. Доступ к админке
- Только авторизованные админы
- Проверка email в списке админов
- Логирование всех действий

### 3. Экспорт данных
- CSV с BOM для корректного отображения кириллицы
- Все даты в локальном формате
- Защита от SQL инъекций

## Мониторинг и аудит

### 1. Логирование
- Все операции с согласиями логируются
- Сохранение IP адресов для аудита
- Отслеживание изменений согласий

### 2. Регулярные проверки
- Ежемесячный экспорт данных
- Проверка целостности данных
- Аудит соответствия GDPR

### 3. Обработка запросов пользователей
- Возможность отзыва согласия
- Право на удаление данных
- Экспорт данных пользователя

## Контакты для вопросов

При возникновении вопросов по обработке персональных данных обращайтесь:
- Email: privacy@spivanka.com
- Телефон: +380XXXXXXXXX
- Адрес: [адрес компании] 